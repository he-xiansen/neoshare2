### 在windows上使用wsl安装使用llama2
参考教程：

[在Python中使用Llama2_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1m34y1M7dM/?p=3&spm_id_from=pageDriver&vd_source=67b78798680727531b234119307894bf)

#### wsl安装ubuntu12虚拟机
```shell
wsl --list    # 查看有哪些虚拟机
wsl --list --online  # 查看有哪些虚机可以下载
wsl --install -d Ubuntu-22.04  # 安装ubuntu并进入系统
wsl         # 即可进入默认安装的 Linux 发行版
wsl -d <distribution name>  # 进入某个系统
wsl -l -v # 查看有哪些虚拟机，哪些虚拟机是开着的
wsl --export Ubuntu-22.04 G:\Ubuntu-22.04.tar # 导出为tar文件
wsl --unregister Ubuntu-22.04   # 注销c盘原有的ubuntu
# 将导出的ubuntu导入到E盘下，
wsl --import Ubuntu-22.04 E:\Ubuntu-22.04 G:\Ubuntu-22.04.tar --version 2
wsl --distribution Ubuntu-22.04 --user zack #使用用户zack进入


```

#### 安装miniconda
下载链接：

[Miniconda — Anaconda documentation](https://docs.anaconda.com/free/miniconda/)

```shell
# 下载所需版本，linux 64位
cd ~
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3~~~.sh
回车
一直tab
```

<!-- 这是一张图片，ocr 内容为：DO YOU ACCEPT THE LICENSE TERMS? [YES|NO] [NO]>>> YL -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709623090967-ec823e31-c0db-4e43-ba77-ad3f36317954.png)

<!-- 这是一张图片，ocr 内容为：OR SPECIFY A DIFFERENT LOCATION BELOW 安装路径 [/HOME/ZACK/MINICONDA3] -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709623136681-dd8007e6-e48f-4e3b-b2ac-1d3187eaa268.png)<!-- 这是一张图片，ocr 内容为：DO DO YOU WISH TO UPDATE YOUR SHELL PROFILE TO AUTOMATICALLY INITIALIZE CONDA? ITHIS WILL ACTIVATE CONDA ON STARTUP AND CHANGE THE COMMAND PROMPT WHEN ACTIVATED. MENT NOT BE ACTIVATED ON STARTUP, IF YOU'D PREFER THAT CONDA'S BASE ENVIRONMENT N RUN THE FOLLOWING COMMAND WHEN CONDA IS ACTIVATED: 是否更新SHELL CONDA CONFIG --SET AUTO_ACTIVATE BASE FALSE YOU CAN UNDO THIS BY RUNNING 'CONDA INIT --REVERSE $SHELL? LYESINOL [NO] >>> YES -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709623182457-22c81ecf-08dc-4860-a758-79e85f3f2e35.png)

安装成功！！



<!-- 这是一张图片，ocr 内容为：~/.BASHRC ZACK@LAPTOP-9KGELEPM SOURCE 更新变量环境 (BASE) ZACK@LAPTOP-9KGELEPM: -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709623254031-489aa221-1e9c-4ac2-9379-09f48bad2166.png)

```shell
# 添加镜像源
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
# 配置pip镜像源
pip connfig set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

cd ~
# 下载llama源代码
git clone https://github.com/facebookresearch/llama.git
# 下载llama.cpp
git clone https://github.com/ggerganov/llama.cpp.git
```

+ 进入到llama目录下

<!-- 这是一张图片，ocr 内容为：DESTINAT10N P LAMA (BASE) ZACK@LAPTOP-9KGELEPM CD LLAMA ZACK@LAPTOP-9KGELEPM:~/LLAMAS LL (BASE) TOTAL 1324 4096 0CT 22 11:01 DRWXR-XR-X  5 ZACK ZACK 4096 0CT 22 11:19 ZACK DRWXR-------------X--------X-XACK 4096 0CT 22 11:01 ZACK DRWXR-XR-X 8 ZACK 1 GIT/ 4096 0CT 22 11:01 .GITHUB/ DRWXR-XR-X 3 ZACK ZACK 3077 0CT 22 11:01 .GITIGNORE* RWXR-XR-X 1 ZACK ZACK 3536 OCT 22 11:01 CODE_OF_CONDUCT.MD RW-R-R---R-RACK ZACK 1236 0CT 22 11:01 CONTRIBUTING.MD RW-R--R--1 ZACK ZACK 6356 OCT 22 11:01 FAQ.MD ZACK -RW-P--P-1 ZACK 7023 0CT 22 11:01 LICENSE ZACK ZACK -IW-I-T-- 7613 0CT 22 11:01 MODEL_CARD.MD ZACK ZACK 7856 OCT 22 11:01 README.MD* ZACK ZACK IWXT-XT-X ZACK 1253223 OCT 22 11:01 RESPONSIBLE-USE-GUIDE.PDF RW-R--R-- 1 ZACK ZACK 1930 0CT 22 11:01 UPDATES.MD -RW-N--R-- 1 ZACK ZACK 4766 0CT 22 11:01 USE_POLICY.MD 1 ZACK ZACK PW-P-II 1 ZACK ZACK 2515 OCT 22 11:01 DOWNLOAD.SH* X-TX-IXMJX 4602 OCT 22 11:01 EXAMPLE_CHAT_COMPLETION.PY 1 ZACK ZACK TWM 2443 0CT 22 11:01 EXAMPLE_TEXT_COMPLETION.PY* 1 ZACK ZACK X-TX-TXMJ- 4096 0CT 22 11:01 LLAMA/ ZACK ZACK XMXP-XT-X 35 OCT 22 11:01 REQUIREMENTS.TXT* -RWXR-XR-X 1 ZACK ZACK 426 OCT 22 11:01 SETUP.PY ZACK RWXR-XP-X 1 ZACK 2 (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA$ -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709623797060-40a1c5e4-5b37-4456-a20b-726baeb634e1.png)

官网下载llama：（需翻墙）

[https://llama.meta.com/llama-downloads/](https://llama.meta.com/llama-downloads/)

<!-- 这是一张图片，ocr 内容为：ZACK FAIR SOCKWZ@163.COM 别填中国 UNITED STATES NASA SELECT THE MODELS YOU WOULD LIKE ACCESS TO: LLAMA 2 LLAMA CHAT CODE LLAMA -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709624439944-656fc59f-ddef-4e50-a0e5-b5643c2424d4.png)<!-- 这是一张图片，ocr 内容为：REPORTING BUGS AND SECURITY CONCERNS: FACEBOOK.COM/WHITEHAT/INFO REPORTING VLOLATIONS OF THE ACCEPTABLE USE POLLCY OR UNIICENSED USES OF LLAMA:LLAMAUSEREPORTOMETA.COM BY    METIN"ACCENT AND CONM  THE THE THE   METING  METING  METING  METING  METICENSE,ACCESTABIVE  MET LACCEPT THE TERMS AND CONDITIONS ACCEPT AND CONTINUE -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709624460659-c92b727c-eafc-4ca1-863d-5f11a778a4b8.png)<!-- 这是一张图片，ocr 内容为：1930 0CT 22  11:01 UPDATES.MD -PW--R---1 ZA ZACK ZACK CT 22 11:01 USE_POLICY.MD 4766  0CT ZACK ZACK -RW-P-P--1 ZA 2 11:01 DOWNLOAD.SH* 2515 0CT 22 1 ZACK ZACK -RWXP-XI-X ] 4602 OCT 221 2 11:01 EXAMPLE_CHAT_COMPLETION.PY -RW-R--R--1 ZACK ZACK 2443 0CT 22 11 11:01 EXAMPLE_TEXT_COMPLETION.PY* -RWXR-XR-X 1 ZACK ZACK 4096 0CT 22 1 11:01 LLAMA/ DRWXR-XR-X    ZACK  ZACK 35 OCT 22 11:01 ZACK ZACK -RWXR-XR-X 1 ZA REQUIREMENTS.TXT* 426 0CT 22 11:01 使用邮箱收到的链接 RWXR-XR-X 1 ZACK ZACK SETUP.PY* (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA$ /DOWNLOAD.S TE7EHEODPNLPLIVNLWACOBGUYKIJALA--GKEY-PAIR-IDEKISORJLYKISORJLYKIFSLZED-REQUAST-ID:710126240981L29 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709624532950-77be9d93-6a19-4202-a067-fe4e44cbe58e.png)<!-- 这是一张图片，ocr 内容为：ENTER THE LIST OF MODELS TO DOWNTOAD NITHOUT SPACES (7B,13B,7BB,7B-CHAT,L3B-CHAT, 7BB-CHAT), ENTER FO 7B-CHAT DOWNLOADING LICENSE AND ACCEPTABLE USAGE POLICY 选择要下载的版本 ZV3EMCWB3VINMX -2923-18-23 12:02:31-- HTTOS://DOMNLOAD,LLAMANETA.NET/LICEISEZPALICYEZPOLICYENILBAQ10LTZTNYUAZE3ZY93Y -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709624577759-587f248c-c689-4055-968b-e75133003aaa.png)

下载完后会出现一个llama的文件夹

<!-- 这是一张图片，ocr 内容为：(BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA$ 11 TOTAL 1328 4096 0CT 22 12:09 DRWXR-XR-X 6 ZACK ZACK 4096 0CT 22  19 DRWXR------ 8 ZACK 96 OCT 22 11:01 .GIT/ DRWXR-XR-X 8 ZA 4096 B ZACK ZACK 4096 0CT 22 11:01 .GITHUB/ ZACK DRWXR-XR-X 3 ZACK 3077 0CT 22 11:01 .GITIGNORE* X 1 ZACK ZACK -IWXT-XT-X CT 22 11:01 CODE_OF_CONDUCT.MD OCT  ZACK 3536 1 ZACK CT 22 11:01 CONTRIBUTING.MD OCT 1236 -RW-R--R-- 1 ZACK ZACK 6356 OCT 22 11:01 FAQ.MD 1 ZACK ZACK -IW-T-T-- 7023  0CT 22 11:01 LICENSE 1 ZACK ZACK 7613 0CT 22 11:01 MODEL_CARD,MD -RW-R--R-- 1 ZACK ZACK 78560CT 22 11:01 README.MD ZACK -RWXR-XR-X 1 ZACK Z 8 OCT 22 11:01 RESPONSIBLE-USE-GUIDE.PDF ZACK 1253223 OCT 1 ZACK -PM-I----- 1930 0CT 22 11:01 UPDATES.MD ZACK 1 ZACK -PW-P--T-- 4766 0CT 22 11:01 USE_POLICY.MD ZACK 1 ZACK 2515 0CT 22 11:01 DOWNLOAD.SH* ZACK -RWXR-XR-X 1 ZACK 4602 0CT 22 11:01 EXAMPLE_CHAT_COMPLETION.PY -RW-R--R-- 1 ZACK ZACK 2443 OCT 22 11:01 EXAMPLE_TEXT_COMPLETION.PY* ZACK ZACK -RWXP-XR-X 1 2 4096 0CT 22  11 DRWXR-XR-X 2 ZACK ZACK 现在 4096 0CT 22 12:09 1LAMA-2-7B-CHAT/ ZACK DRWXR-XR-X    ZACK ZA 35 OCT 22 11:01 REQUIREMENTS.TXT* -RWXR-XR-X 1 ZACK ZACK 426 0CT 22 11:01 SETUP.PY* -RWXR-XR-X 1 ZACK ZACK (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA$ -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709626294211-ac0df176-6954-45ce-be65-578070e7d6d7.png)



+ 进入到llama.cpp目录下

```shell
cd llama.cpp
sudo apt update
sudo apt install build-essential
gcc --version  # 查看版本
make  # 编译
python3 -m pip install -r requirement.txt
python3 conver.py --outfile ./models/llama-2-7b-chat ../llama/llama-2-7b-chat/ # 转换
```

<!-- 这是一张图片，ocr 内容为：(BASE) ZA ZACK@LAPTOP-9KGELEPM:~/LLAMA.CPP$ CD M MODELS/ (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA.CPP/MODELS$ LS LLAMA-2-7B-CHAT (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA.CPP/MODELS$ MKDIR 7B MA.CPP/MODELS$ MV LLAMA-2-7B-CHAT 7B/GGML-MODEL-F16.BIN (BASE) ZACK@LAPTOP-9KGELEPM:~/LLAMA -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709627109861-72b041b9-0376-40c3-8383-49ea1ed19559.png)

量化减少内存

<!-- 这是一张图片，ocr 内容为：ZACK@LAPTOP-9KGELEPM:~/LLAMA.CPP$ ./QUANTIZE (BASE) /MODELS/7B/9GML-MODEL-F16.BIN ./MODELS/7B/GGML-MODEL-Q4-0.G Q4-0 .GGUF 4BIT量化 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709628092424-e55bb0da-8533-4e41-aaab-6ce63ce37c72.png)

<!-- 这是一张图片，ocr 内容为：PROMPTS/CHAT-WITH-B (BASE) ZACK@LAPTOP-9KGELEPM:-/LLA ./MODELS/7B/GGML-MO ~/LAMA.CPP$ 256 /MAIN 1.0 USER: PENALTY REPEAT GGUF OB.TXT 启动模型 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709628964494-f6abe093-69f5-47af-9f26-50839cfdd4db.png)

```shell
# custom arguments using a 13B model
./main -m ./models/13B/ggml-model-q4_0.gguf -n 256 --repeat_penalty 1.0 --color -i -r "User:" -f prompts/chat-with-bob.txt
```

<!-- 这是一张图片，ocr 内容为：USER:HOW OLD ARE YOU? BOB: I'M JUST AN AI, I DON'T HAVE A PHYSICAL BODY OR AGE, SO I DON'T HA USER: 开始使用 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629033810-f5d622cc-b47a-49e2-94e5-34575b370726.png)

#### 在python中使用llama-cpp
<!-- 这是一张图片，ocr 内容为：(TORCH2) PS D:WORKPLACE(PYTHONWORKPLACELMACHINELEARNINGPRACTICE> PID INSTALL LLAMA-EPP-PPP-PYTHON LOOKING IN INDEXES: HTTPS://PYPI.MIRRORS.USTC.EDU.CN/SIMPLE/ 安装包 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629325466-e9dd01c1-b3cc-4b3b-9bed-9ea501b86110.png)

通过cp命令将wsl中的模型文件复制到windows下

<!-- 这是一张图片，ocr 内容为：CP /MODELS/XXX /MNT/G/DDD -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629562176-ff031c8e-f519-4185-89cb-6f5fef9cb0f0.png)<!-- 这是一张图片，ocr 内容为：此电脑 > FILES(G:) LIAMA2 LLAMA-2-13B-CHAT-Q4 MODELS 排序 查看 类型 大小 修改日期 名称 2023/10/21 0:27 7,193,198... GGUF文件 9GML-MODEL-Q4_0.GGUF -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629539617-7bfd3397-a1eb-4034-a4e6-c1a4af00ccfe.png)

第一种方式使用

<!-- 这是一张图片，ocr 内容为：LLAMA INFERENCE.PY IMPORTLLAMA LLAMA_CPPI FROM MODEL-PATH - R"G:\MODELS\LLAMA2\LLAMA-2-13B-CHAT-Q4\GGML-MODEL-Q4-0.9GUF" LLM : LLAMA(MODEL_PATH-MODEL_PATH, VERBOSE-FALSE) PRINT(LLM('HOW OLD ARE YOU?') 使用代码 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629691436-935ac074-d273-44d8-88a0-d3b74f5244d0.png)

第二种方式使用

<!-- 这是一张图片，ocr 内容为：FROM LANGCHAIN.LLMS.LLAMACPP IMPORT LLAMACPP MODEL-PATH -F"G:\MODELS\LLAMA2\LLAMA-2-13B-CHAT-Q4\GGML-MODEL-Q4-0.9GUF" LLM : LLAMACPP(MODEL_PATH-MODEL-PATH,VERBOSE-FALSE) FOR S IN LLM.STREAM("WRITE ME A POEM."): PRINT(S,END",FLUSHTRUE) 使用代码 -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709629871843-8046032d-a13a-4c09-8c46-79cbea75505a.png)

### Ollama实现本地化RAG应用
+ 需要一个聊天模型

<!-- 这是一张图片，ocr 内容为：OLLAMA.COM SIGN IN SCORDGITHUB MADELS SEARCH MODELS -->
![](https://cdn.nlark.com/yuque/0/2024/png/21360294/1709706779596-8d3ce180-a360-4d8f-8ba4-017a748a6785.png)

